# Gemini CLI アーキテクチャ概要

このドキュメントでは、Gemini CLIのアーキテクチャの概要を説明します。

## コアコンポーネント

Gemini CLIは、主に2つの主要なパッケージと、コマンドライン入力の処理中にシステムが使用できる一連のツールで構成されています。

1.  **CLIパッケージ (`packages/cli`):**

    - **目的:** Gemini CLIのユーザー向けの部分が含まれます。これには、最初のユーザー入力の処理、最終的な出力の表示、および全体的なユーザーエクスペリエンスの管理などが含まれます。
    - **パッケージに含まれる主な機能:**
      - [入力処理](./cli/commands.md)
      - 履歴管理
      - 表示レンダリング
      - [テーマとUIのカスタマイズ](./cli/themes.md)
      - [CLI設定](./cli/configuration.md)

2.  **コアパッケージ (`packages/core`):**

    - **目的:** Gemini CLIのバックエンドとして機能します。`packages/cli`から送信されたリクエストを受け取り、Gemini APIとの対話を調整し、利用可能なツールの実行を管理します。
    - **パッケージに含まれる主な機能:**
      - Google Gemini APIと通信するためのAPIクライアント
      - プロンプトの構築と管理
      - ツールの登録と実行ロジック
      - 会話またはセッションの状態管理
      - サーバー側の設定

3.  **ツール (`packages/core/src/tools/`):**
    - **目的:** これらはGeminiモデルの機能を拡張する個別のモジュールであり、ローカル環境（ファイルシステム、シェルコマンド、Webフェッチなど）と対話できるようにします。
    - **対話:** `packages/core`は、Geminiモデルからのリクエストに基づいてこれらのツールを呼び出します。

## 対話フロー

Gemini CLIとの典型的な対話は次のフローに従います。

1.  **ユーザー入力:** ユーザーはプロンプトまたはコマンドをターミナルに入力し、これは`packages/cli`によって管理されます。
2.  **コアへのリクエスト:** `packages/cli`はユーザーの入力を`packages/core`に送信します。
3.  **リクエストの処理:** コアパッケージは次の処理を行います。
    - 会話履歴や利用可能なツールの定義を含め、Gemini APIに適したプロンプトを構築します。
    - プロンプトをGemini APIに送信します。
4.  **Gemini APIの応答:** Gemini APIはプロンプトを処理し、応答を返します。この応答は、直接の回答であるか、利用可能なツールのいずれかを使用するリクエストである可能性があります。
5.  **ツールの実行 (該当する場合):**
    - Gemini APIがツールをリクエストすると、コアパッケージはそれを実行する準備をします。
    - 要求されたツールがファイルシステムを変更したり、シェルコマンドを実行したりできる場合、ユーザーには最初にツールの詳細とその引数が提供され、ユーザーは実行を承認する必要があります。
    - ファイルの読み取りなどの読み取り専用操作は、続行するために明示的なユーザーの確認を必要としない場合があります。
    - 確認された後、または確認が不要な場合、コアパッケージは関連するツール内で関連するアクションを実行し、結果はコアパッケージによってGemini APIに返送されます。
    - Gemini APIはツールの結果を処理し、最終的な応答を生成します。
6.  **CLIへの応答:** コアパッケージは最終的な応答をCLIパッケージに返します。
7.  **ユーザーへの表示:** CLIパッケージは応答をフォーマットし、ターミナルでユーザーに表示します。

## 主要な設計原則

- **モジュール性:** CLI（フロントエンド）とコア（バックエンド）を分離することで、独立した開発と将来の拡張（例：同じバックエンドの異なるフロントエンド）が可能になります。
- **拡張性:** ツールシステムは拡張可能に設計されており、新しい機能を追加できます。
- **ユーザーエクスペリエンス:** CLIは、リッチでインタラクティブなターミナルエクスペリエンスを提供することに重点を置いています。 