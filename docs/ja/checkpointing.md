# チェックポイント

Gemini CLIにはチェックポイント機能が含まれており、AI搭載ツールによってファイルが変更される前に、プロジェクトの状態のスナップショットを自動的に保存します。これにより、ツールが実行される前の状態に即座に戻すことができるため、安全にコードの変更を試したり適用したりできます。

## 仕組み

ファイルシステムを変更するツール（`write_file`や`replace`など）を承認すると、CLIは自動的に「チェックポイント」を作成します。このチェックポイントには次のものが含まれます。

1.  **Gitスナップショット:** ホームディレクトリ（`~/.gemini/history/<project_hash>`）にある特別なシャドウGitリポジトリにコミットが作成されます。このスナップショットは、その時点でのプロジェクトファイルの完全な状態をキャプチャします。これは、あなた自身のプロジェクトのGitリポジトリには干渉**しません**。
2.  **会話履歴:** その時点までエージェントと交わしたすべての会話が保存されます。
3.  **ツール呼び出し:** 実行されようとしていた特定のツール呼び出しも保存されます。

変更を元に戻したい場合や、単に戻りたい場合は、`/restore`コマンドを使用できます。チェックポイントを復元すると、次のようになります。

- プロジェクト内のすべてのファイルが、スナップショットでキャプチャされた状態に戻ります。
- CLIの会話履歴が復元されます。
- 元のツール呼び出しが再提案され、再度実行したり、変更したり、単に無視したりできます。

Gitスナップショットや会話履歴を含むすべてのチェックポイントデータは、お使いのコンピュータにローカルに保存されます。Gitスナップショットはシャドウリポジトリに保存され、会話履歴とツール呼び出しはプロジェクトの一時ディレクトリ（通常は`~/.gemini/tmp/<project_hash>/checkpoints`）にあるJSONファイルに保存されます。

## 機能の有効化

チェックポイント機能はデフォルトで無効になっています。有効にするには、コマンドラインフラグを使用するか、`settings.json`ファイルを編集します。

### コマンドラインフラグの使用

Gemini CLIの起動時に`--checkpointing`フラグを使用して、現在のセッションのチェックポイントを有効にできます。

```bash
gemini --checkpointing
```

### `settings.json`ファイルの使用

すべてのセッションでデフォルトでチェックポイントを有効にするには、`settings.json`ファイルを編集する必要があります。

`settings.json`に次のキーを追加します。

```json
{
  "features": {
    "checkpointing": {
      "enabled": true
    }
  }
}
```

## `/restore`コマンドの使用

有効にすると、チェックポイントは自動的に作成されます。それらを管理するには、`/restore`コマンドを使用します。

### 利用可能なチェックポイントのリスト

現在のプロジェクトで保存されているすべてのチェックポイントのリストを表示するには、次のように実行します。

```
/restore
```

CLIに利用可能なチェックポイントファイルのリストが表示されます。これらのファイル名は通常、タイムスタンプ、変更されるファイルの名前、および実行されようとしていたツールの名前で構成されます（例：`2025-06-22T10-00-00_000Z-my-file.txt-write_file`）。

### 特定のチェックポイントの復元

プロジェクトを特定のチェックポイントに復元するには、リストからチェックポイントファイルを使用します。

```
/restore <checkpoint_file>
```

例：

```
/restore 2025-06-22T10-00-00_000Z-my-file.txt-write_file
```

コマンドを実行すると、ファイルと会話はチェックポイントが作成されたときの状態にすぐに復元され、元のツールプロンプトが再表示されます。 