# トラブルシューティングガイド

このガイドでは、一般的な問題の解決策とデバッグのヒントを提供します。

## よくある質問 (FAQ)

- **Q: Gemini CLIを最新バージョンに更新するにはどうすればよいですか？**

  - A: npmを介してグローバルにインストールした場合、`npm install -g @google/gemini-cli@latest`コマンドを使用してGemini CLIを更新します。ソースから実行している場合は、リポジトリから最新の変更をプルし、`npm run build`を使用して再ビルドします。

- **Q: Gemini CLIの設定ファイルはどこに保存されていますか？**

  - A: CLIの設定は、ホームディレクトリとプロジェクトのルートディレクトリにある2つの`settings.json`ファイルに保存されています。どちらの場所でも、`settings.json`は`.gemini/`フォルダにあります。詳細については、[CLI設定](./cli/configuration.md)を参照してください。

- **Q: 統計出力にキャッシュされたトークン数が表示されないのはなぜですか？**

  - A: キャッシュされたトークン情報は、キャッシュされたトークンが使用されている場合にのみ表示されます。この機能は、APIキーユーザー（Gemini APIキーまたはVertex AI）で利用できますが、現時点ではOAuthユーザー（Google個人/エンタープライズアカウント）では利用できません。これは、Code Assist APIがキャッシュされたコンテンツの作成をサポートしていないためです。`/stats`コマンドで合計トークン使用量を確認することはできます。

## 一般的なエラーメッセージと解決策

- **エラー: MCPサーバー起動時の`EADDRINUSE` (アドレスは既に使用されています)。**

  - **原因:** MCPサーバーがバインドしようとしているポートを別のプロセスが既に使用しています。
  - **解決策:**
    ポートを使用している他のプロセスを停止するか、MCPサーバーが別のポートを使用するように設定します。

- **エラー: コマンドが見つかりません (Gemini CLIを実行しようとしたとき)。**

  - **原因:** Gemini CLIが正しくインストールされていないか、システムのPATHに含まれていません。
  - **解決策:**
    1. Gemini CLIのインストールが成功したことを確認します。
    2. グローバルにインストールした場合は、npmのグローバルバイナリディレクトリがPATHに含まれていることを確認します。
    3. ソースから実行している場合は、正しいコマンドを使用して呼び出していることを確認します (例: `node packages/cli/dist/index.js ...`)。

- **エラー: `MODULE_NOT_FOUND`またはインポートエラー。**

  - **原因:** 依存関係が正しくインストールされていないか、プロジェクトがビルドされていません。
  - **解決策:**
    1. `npm install`を実行して、すべての依存関係が存在することを確認します。
    2. `npm run build`を実行して、プロジェクトをコンパイルします。

- **エラー: 「操作は許可されていません」、「権限がありません」、または同様のエラー。**

  - **原因:** サンドボックスが有効になっている場合、アプリケーションは、プロジェクトディレクトリまたはシステムの一時ディレクトリ外への書き込みなど、サンドボックスによって制限されている操作を試行している可能性があります。
  - **解決策:** サンドボックス設定のカスタマイズ方法など、詳細については[サンドボックス](./cli/configuration.md#sandboxing)を参照してください。

## デバッグのヒント

- **CLIのデバッグ:**

  - 詳細な出力を得るには、CLIコマンドで`--verbose`フラグ (利用可能な場合) を使用します。
  - 多くの場合、ユーザー固有の設定またはキャッシュディレクトリにあるCLIログを確認します。

- **コアのデバッグ:**

  - サーバーのコンソール出力でエラーメッセージやスタックトレースを確認します。
  - 設定可能であれば、ログの詳細度を上げます。
  - サーバー側のコードをステップ実行する必要がある場合は、Node.jsのデバッグツール (例: `node --inspect`) を使用します。

- **ツールの問題:**

  - 特定のツールが失敗している場合は、ツールが実行するコマンドまたは操作の最も単純なバージョンを実行して問題を切り分けます。
  - `run_shell_command`の場合は、まずシェルでコマンドが直接機能することを確認します。
  - ファイルシステムツールの場合は、パスと権限を再確認します。

- **プリフライトチェック:**
  - コードをコミットする前に、必ず`npm run preflight`を実行してください。これにより、フォーマット、リンティング、型エラーに関連する多くの一般的な問題を検出できます。

ここに記載されていない問題が発生した場合は、GitHubでプロジェクトの課題トラッカーを検索するか、詳細情報を添えて新しい課題を報告することを検討してください。 